{"version":3,"sources":["services/urql-graphql-client.service.ts","../../src/Injector.ts","../../src/index.tsx","App.tsx","index.tsx"],"names":["GRAPHQL_API","UrqlGraphQLService","useQuery","useMutation","Injector","dependencies","parentInjector","dependencyGraph","this","registerProvider","providerToken","dependency","configs","markDependencies","dep","token","deps","e","parentDep","Error","instance","getConstructorFunc","Object","constructorFunc","getNodeData","resolveDependencies","providerConfig","inject","service","InjectorContext","injector","InjectorContextProvider","providers","children","React","value","withProviders","component","Component","providerList","compDeps","InjectorContextConsumer","withInjector","client","createClient","url","AnimeCharacterPage","lazy","appProviders","provide","useValue","StrictMode","Suspense","fallback","basename","path","exact","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.5bcda660.chunk.js","sourcesContent":["import { useMutation, useQuery } from 'urql'\r\n\r\nexport const GRAPHQL_API = 'GraphQLService'\r\n\r\nexport const UrqlGraphQLService = {\r\n  useQuery,\r\n  useMutation\r\n}\r\n","/* eslint-disable new-cap */\r\nimport { DepGraph, DepGraphCycleError } from 'dependency-graph'\r\nimport { ConstructorProvider, InjectionToken, Provider, ProviderConfigs } from './provider.type'\r\n\r\nexport class Injector {\r\n  private dependencyGraph = new DepGraph<any>()\r\n\r\n  constructor(dependencies: Provider[] = [], private parentInjector: Injector | null = null) {\r\n    dependencies.forEach((dep: any) => this.registerProvider(dep))\r\n    this.resolveDependencies()\r\n  }\r\n\r\n  private registerProvider(dependency: Provider): void {\r\n    const { provide: providerToken, ...configs } = dependency\r\n    this.dependencyGraph.addNode(providerToken, configs)\r\n  }\r\n\r\n  private markDependencies(): void {\r\n    this.dependencyGraph\r\n      .overallOrder()\r\n      .map((dep) => [dep, this.dependencyGraph.getNodeData(dep)])\r\n      .forEach(([token, configs]) => {\r\n        const deps = (configs as any).deps ? (configs as any).deps : []\r\n\r\n        deps.forEach((dep: string) => {\r\n          try {\r\n            this.dependencyGraph.addDependency(token, dep)\r\n          } catch (e) {\r\n            if (e instanceof DepGraphCycleError) {\r\n              throw e\r\n            }\r\n            if ((e as Error).message.includes('Node does not exist')) {\r\n              let parentInjector = this.parentInjector\r\n              let parentDep\r\n              while (parentInjector) {\r\n                try {\r\n                  parentDep = parentInjector.inject(dep)\r\n                  break\r\n                } catch (e) {\r\n                  parentInjector = parentInjector.parentInjector\r\n                }\r\n              }\r\n\r\n              if (parentDep) {\r\n                this.dependencyGraph.addNode(dep, { instance: parentDep })\r\n                this.dependencyGraph.addDependency(token, dep)\r\n              } else {\r\n                throw new Error(`Could not resolve dependency: ${dep} for Injectable: ${token}`)\r\n              }\r\n            }\r\n          }\r\n        })\r\n      })\r\n  }\r\n\r\n  private getConstructorFunc(providerToken: string, providerConfig: ProviderConfigs): Function {\r\n    let constructorFunc\r\n    if (Object.prototype.hasOwnProperty.call(providerConfig, 'useClass')) {\r\n      constructorFunc = (...deps: any) => {\r\n        return new (\r\n          this.dependencyGraph.getNodeData(providerToken) as ConstructorProvider\r\n        ).useClass({ deps })\r\n      }\r\n    }\r\n\r\n    if (Object.prototype.hasOwnProperty.call(providerConfig, 'useFactory')) {\r\n      constructorFunc = this.dependencyGraph.getNodeData(providerToken).useFactory\r\n    }\r\n\r\n    if (Object.prototype.hasOwnProperty.call(providerConfig, 'useValue')) {\r\n      constructorFunc = () => this.dependencyGraph.getNodeData(providerToken).useValue\r\n    }\r\n\r\n    return constructorFunc\r\n  }\r\n\r\n  private resolveDependencies(): void {\r\n    this.markDependencies()\r\n\r\n    this.dependencyGraph.overallOrder().forEach((providerToken: string) => {\r\n      const providerConfig = this.dependencyGraph.getNodeData(providerToken)\r\n\r\n      const constructorFunc = this.getConstructorFunc(providerToken, providerConfig)\r\n\r\n      let deps = (providerConfig as any).deps ? (providerConfig as any).deps : []\r\n      deps = deps.map((dep: string) => this.dependencyGraph.getNodeData(dep).instance)\r\n\r\n      if (providerConfig?.instance == null) {\r\n        const instance = constructorFunc(...deps)\r\n\r\n        this.dependencyGraph.setNodeData(providerToken, {\r\n          ...providerConfig,\r\n          instance\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n  public inject(service: InjectionToken) {\r\n    const dep = this.dependencyGraph.getNodeData(service).instance\r\n\r\n    if (!dep) {\r\n      throw new Error(`Could not find provider :${service}`)\r\n    }\r\n\r\n    return dep\r\n  }\r\n}\r\n","import React, { useEffect } from 'react'\r\nimport { Injector } from './Injector'\r\nimport { Provider } from './provider.type'\r\n\r\ntype InjectorContextType = {\r\n  injector: Injector\r\n}\r\n\r\nconst InjectorContext = React.createContext<InjectorContextType>({\r\n  injector: new Injector()\r\n})\r\n\r\nexport type InjectorContextProviderProps = {\r\n  providers: Provider[]\r\n\r\n  children: React.ReactElement<any>\r\n}\r\n\r\nexport const InjectorContextProvider = ({ providers, children }: InjectorContextProviderProps) => {\r\n  const parentInjector = React.useContext(InjectorContext)\r\n\r\n  return (\r\n    <InjectorContext.Provider\r\n      value={{ injector: new Injector(providers, parentInjector.injector) }}\r\n    >\r\n      {children}\r\n    </InjectorContext.Provider>\r\n  )\r\n}\r\n\r\nconst InjectorContextConsumer = ({ component: Component, providerList }: any) => {\r\n  const { injector } = React.useContext(InjectorContext)\r\n\r\n  const [compDeps] = React.useState(() =>\r\n    providerList.map((dep: any) => {\r\n      return injector.inject(dep)\r\n    })\r\n  )\r\n\r\n  if (!React.isValidElement(Component)) {\r\n    Component = React.createElement(Component)\r\n  }\r\n\r\n  return React.cloneElement(Component, {\r\n    ...Component.props,\r\n\r\n    deps: compDeps\r\n  } as any)\r\n}\r\n\r\nexport const withProviders = (component: any, providerList: string[]): any => {\r\n  return React.memo(() => InjectorContextConsumer({ component, providerList }))\r\n}\r\n\r\nexport const withInjector = (Component: any, providers: Provider[]) => {\r\n  if (React.isValidElement(Component)) {\r\n    return React.memo(() => {\r\n      return <InjectorContextProvider providers={providers}>{Component}</InjectorContextProvider>\r\n    })\r\n  }\r\n\r\n  return React.memo(() => {\r\n    return (\r\n      <InjectorContextProvider providers={providers}>\r\n        <Component />\r\n      </InjectorContextProvider>\r\n    )\r\n  })\r\n}\r\n\r\nexport function useInjector() {\r\n  const { injector } = React.useContext(InjectorContext)\r\n\r\n  return { injector }\r\n}\r\n\r\nexport function useProviders(providerList: string[]) {\r\n  const { injector } = React.useContext(InjectorContext)\r\n\r\n  const [providers, setProviders] = React.useState<Provider[]>([])\r\n\r\n  useEffect(() => {\r\n    setProviders(providerList.map((provider) => injector.inject(provider)))\r\n  }, providerList)\r\n\r\n  return providers\r\n}\r\n\r\nexport type { Provider } from './provider.type'\r\n","import { Provider, withInjector } from '@doughtnerd/wrangler-di'\r\nimport React from 'react'\r\nimport { HashRouter, Route, Switch } from 'react-router-dom'\r\nimport { createClient, Provider as UrqlProvider } from 'urql'\r\nimport { GRAPHQL_API, UrqlGraphQLService } from './services/urql-graphql-client.service'\r\n\r\nconst client = createClient({\r\n  url: 'https://graphql.anilist.co'\r\n})\r\n\r\nconst AnimeCharacterPage = React.lazy(() => import('./pages/AnimeCharacterPage'))\r\n\r\nconst appProviders: Provider[] = [{ provide: GRAPHQL_API, useValue: UrqlGraphQLService }]\r\n\r\nconst App = () => {\r\n  return (\r\n    <React.StrictMode>\r\n      <UrqlProvider value={client}>\r\n        <React.Suspense fallback={<div>Loading...</div>}>\r\n          <HashRouter basename=\"/\">\r\n            <Switch>\r\n              <Route path={'/'} exact>\r\n                <div>Hello!</div>\r\n              </Route>\r\n              <Route path={'/anime-character-details'} exact component={AnimeCharacterPage}></Route>\r\n            </Switch>\r\n          </HashRouter>\r\n        </React.Suspense>\r\n      </UrqlProvider>\r\n    </React.StrictMode>\r\n  )\r\n}\r\n\r\nexport default withInjector(App, appProviders)\r\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './App'\n\nReactDOM.render(<App />, document.getElementById('root'))\n"],"sourceRoot":""}